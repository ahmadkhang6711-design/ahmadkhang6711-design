<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Multi‑Converter Hub</title>
<style>
  :root {
    --bg:#0f172a; --card:#111827; --muted:#cbd5e1; --accent:#10b981; --text:#e5e7eb;
    --border:#1f2937; --muted2:#94a3b8;
  }
  body { margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:var(--bg); color:var(--text); }
  header { padding:24px 16px; text-align:center; border-bottom:1px solid var(--border); }
  header h1 { margin:0 0 8px; font-size:28px; }
  header p { margin:0; color:var(--muted2); }
  .container { max-width:980px; margin: 0 auto; padding: 16px; }
  .tabs { display:flex; flex-wrap:wrap; gap:8px; margin: 16px 0; }
  .tab-btn {
    padding:10px 14px; border:1px solid var(--border); color:var(--muted);
    background:linear-gradient(180deg,#0b1220,#0b1322); border-radius:10px; cursor:pointer;
  }
  .tab-btn.active { border-color:var(--accent); color:#d1fae5; box-shadow: 0 0 0 1px rgba(16,185,129,.3) inset; }
  .card { background:linear-gradient(180deg,#0b1220,#0b1322); border:1px solid var(--border); border-radius:14px; padding:18px; margin-bottom:16px; }
  .grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
  .grid-3 { display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; }
  .row { display:flex; gap:10px; flex-wrap:wrap; }
  label { font-size:13px; color:var(--muted2); }
  input, select, textarea, button {
    width:100%; padding:10px; border-radius:10px; border:1px solid var(--border);
    background:#0a0f1d; color:var(--text); outline:none;
  }
  textarea { min-height:120px; resize:vertical; }
  button.action { background: linear-gradient(180deg,#0a1f16,#0a2319); border-color:#134e4a; color:#d1fae5; font-weight:600; }
  .result { margin-top:8px; padding:10px; border-radius:10px; background:#0a0f1d; border:1px dashed #1e293b; color:#d1fae5; }
  .hint { color:var(--muted2); font-size:12px; margin-top:4px; }
  .footer { text-align:center; color:var(--muted2); padding:24px 0 40px; font-size:12px; }
  h3 { margin-top:0; }
  code { color:#93c5fd; }
  @media (max-width: 720px) { .grid, .grid-3 { grid-template-columns:1fr; } }
</style>
</head>
<body>
<header>
  <h1>Multi‑Converter Hub</h1>
  <p>All‑in‑one: currency, units, time zones, file formats, and PDF tools — free and fast.</p>
</header>

<div class="container">
  <div class="tabs">
    <button class="tab-btn active" data-tab="currency">Currency</button>
    <button class="tab-btn" data-tab="units">Units</button>
    <button class="tab-btn" data-tab="timezones">Time Zones</button>
    <button class="tab-btn" data-tab="files">File Formats</button>
    <button class="tab-btn" data-tab="pdf">PDF Tools</button>
  </div>

  <!-- Currency Converter -->
  <section id="currency" class="card">
    <h2>Currency converter</h2>
    <div class="grid">
      <div>
        <label>Amount</label>
        <input type="number" id="curAmount" value="1" step="any" />
      </div>
      <div>
        <label>&nbsp;</label>
        <button class="action" onclick="convertCurrency()">Convert</button>
      </div>
      <div>
        <label>From</label>
        <select id="curFrom"></select>
      </div>
      <div>
        <label>To</label>
        <select id="curTo"></select>
      </div>
    </div>
    <div id="curResult" class="result">Enter an amount to convert.</div>
    <div class="hint">Live rates via exchangerate.host (free, no API key).</div>
  </section>

  <!-- Units Converter -->
  <section id="units" class="card" style="display:none">
    <h2>Units converter</h2>
    <div class="grid-3">
      <div>
        <label>Category</label>
        <select id="unitCategory" onchange="populateUnits()">
          <option>Length</option>
          <option>Weight</option>
          <option>Temperature</option>
          <option>Area</option>
          <option>Volume</option>
          <option>Speed</option>
        </select>
      </div>
      <div>
        <label>From unit</label>
        <select id="unitFrom"></select>
      </div>
      <div>
        <label>To unit</label>
        <select id="unitTo"></select>
      </div>
    </div>
    <div class="grid">
      <div>
        <label>Value</label>
        <input type="number" id="unitValue" value="1" step="any" />
      </div>
      <div>
        <label>&nbsp;</label>
        <button class="action" onclick="convertUnits()">Convert</button>
      </div>
    </div>
    <div id="unitResult" class="result">Select a category and enter a value.</div>
  </section>

  <!-- Time Zone Converter -->
  <section id="timezones" class="card" style="display:none">
    <h2>Time zone converter</h2>
    <div class="grid">
      <div>
        <label>Date & time</label>
        <input type="datetime-local" id="tzDateTime" />
      </div>
      <div>
        <label>&nbsp;</label>
        <button class="action" onclick="convertTime()">Convert</button>
      </div>
      <div>
        <label>From time zone</label>
        <select id="tzFrom"></select>
      </div>
      <div>
        <label>To time zone</label>
        <select id="tzTo"></select>
      </div>
    </div>
    <div id="tzResult" class="result">Pick a date/time and zones to convert.</div>
    <div class="hint">Powered by the browser’s Intl API with Luxon for accurate TZ math.</div>
  </section>

  <!-- File Format Tools -->
  <section id="files" class="card" style="display:none">
    <h2>File format tools</h2>

    <div class="card" style="margin:8px 0;">
      <h3>Image format converter (PNG ⇄ JPG ⇄ WebP)</h3>
      <div class="grid">
        <div>
          <label>Select image</label>
          <input type="file" id="imgInput" accept="image/*" />
        </div>
        <div>
          <label>Output format</label>
          <select id="imgFormat">
            <option value="image/png">PNG</option>
            <option value="image/jpeg">JPG</option>
            <option value="image/webp">WebP</option>
          </select>
        </div>
      </div>
      <div>
        <label>Quality (JPG/WebP)</label>
        <input type="range" id="imgQuality" min="0.1" max="1" step="0.1" value="0.9" />
      </div>
      <button class="action" onclick="convertImage()">Convert image</button>
      <div id="imgResult" class="result">No image converted yet.</div>
    </div>

    <div class="card" style="margin:8px 0;">
      <h3>CSV ⇄ JSON converter</h3>
      <div class="row">
        <div style="flex:1">
          <label>Input</label>
          <textarea id="textInput" placeholder='CSV or JSON here...'></textarea>
        </div>
      </div>
      <div class="row">
        <button class="action" onclick="csvToJson()">CSV ➜ JSON</button>
        <button class="action" onclick="jsonToCsv()">JSON ➜ CSV</button>
      </div>
      <div>
        <label>Output</label>
        <textarea id="textOutput" placeholder='Result will appear here...'></textarea>
      </div>
      <div class="row">
        <button onclick="downloadText()">Download result</button>
      </div>
      <div class="hint">Handles typical CSV (quoted values). Complex CSV may need a dedicated parser.</div>
    </div>

    <div class="card" style="margin:8px 0;">
      <h3>Text tools (Base64 & Case)</h3>
      <div class="grid">
        <div>
          <label>Text</label>
          <textarea id="txtToolInput" placeholder="Type or paste text..."></textarea>
        </div>
        <div>
          <label>Output</label>
          <textarea id="txtToolOutput" placeholder="Results appear here..."></textarea>
        </div>
      </div>
      <div class="row">
        <button onclick="toBase64()">Encode Base64</button>
        <button onclick="fromBase64()">Decode Base64</button>
        <button onclick="toUpper()">UPPERCASE</button>
        <button onclick="toLower()">lowercase</button>
        <button onclick="toTitle()">Title Case</button>
      </div>
    </div>
  </section>

  <!-- PDF Tools -->
  <section id="pdf" class="card" style="display:none">
    <h2>PDF tools</h2>

    <div class="card" style="margin:8px 0;">
      <h3>Merge PDFs</h3>
      <div class="grid">
        <div>
          <label>Select PDF files</label>
          <input type="file" id="pdfMergeFiles" accept="application/pdf" multiple />
        </div>
        <div>
          <label>&nbsp;</label>
          <button class="action" onclick="mergePDFs()">Merge</button>
        </div>
      </div>
      <div id="pdfMergeResult" class="result">No PDFs merged yet.</div>
    </div>

    <div class="card" style="margin:8px 0;">
      <h3>Split PDF by page range</h3>
      <div class="grid">
        <div>
          <label>Select a PDF</label>
          <input type="file" id="pdfSplitFile" accept="application/pdf" />
        </div>
        <div>
          <label>Page range (e.g., 1-3,5,7-9)</label>
          <input id="pdfRange" placeholder="1-3,5" />
        </div>
      </div>
      <button class="action" onclick="splitPDF()">Split</button>
      <div id="pdfSplitResult" class="result">Select a file and range.</div>
    </div>

    <div class="card" style="margin:8px 0;">
      <h3>Images ➜ PDF</h3>
      <div class="grid">
        <div>
          <label>Select images</label>
          <input type="file" id="pdfImages" accept="image/*" multiple />
        </div>
        <div>
          <label>Page size</label>
          <select id="pdfPageSize">
            <option value="fit">Fit to image</option>
            <option value="A4">A4 portrait</option>
            <option value="A4L">A4 landscape</option>
          </select>
        </div>
      </div>
      <button class="action" onclick="imagesToPDF()">Create PDF</button>
      <div id="pdfImgResult" class="result">No PDF created yet.</div>
    </div>

    <div class="hint">All PDF actions run locally in your browser using pdf-lib. No uploads.</div>
  </section>

  <div class="footer">
    Built for evergreen use. Host free on GitHub Pages or embed in your site. © YourBrand
  </div>
</div>

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>

<script>
/* ========== Tabs ========== */
document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('section.card').forEach(s=>s.style.display='none');
    btn.classList.add('active');
    document.getElementById(btn.dataset.tab).style.display='block';
  });
});

/* ========== Currency ========== */
// ISO currency code → symbol map (covers the global set where symbols exist)
// Note: Some currencies share symbols or have none; those entries display without parentheses.
const SYMBOLS = {
  AFN:"؋", ALL:"L", AMD:"֏", ANG:"ƒ", AOA:"Kz", ARS:"$", AUD:"A$", AWG:"ƒ", AZN:"₼",
  BAM:"KM", BBD:"$", BDT:"৳", BGN:"лв", BHD:".د.ب", BIF:"FBu", BMD:"$", BND:"$", BOB:"Bs",
  BRL:"R$", BSD:"$", BTN:"Nu.", BWP:"P", BYN:"Br", BZD:"BZ$", CAD:"C$", CDF:"FC", CHF:"CHF",
  CLP:"$", CNY:"¥", COP:"$", CRC:"₡", CUP:"₱", CVE:"$", CZK:"Kč", DJF:"Fdj", DKK:"kr",
  DOP:"RD$", DZD:"دج", EGP:"£", ERN:"Nkf", ETB:"Br", EUR:"€", FJD:"$", FKP:"£", FOK:"kr",
  GBP:"£", GEL:"₾", GGP:"£", GHS:"₵", GIP:"£", GMD:"D", GNF:"FG", GTQ:"Q", GYD:"$",
  HKD:"HK$", HNL:"L", HRK:"kn", HTG:"G", HUF:"Ft", IDR:"Rp", ILS:"₪", IMP:"£", INR:"₹",
  IQD:"ع.د", IRR:"﷼", ISK:"kr", JEP:"£", JMD:"J$", JOD:"د.ا", JPY:"¥", KES:"KSh", KGS:"лв",
  KHR:"៛", KID:"$", KMF:"CF", KRW:"₩", KWD:"د.ك", KYD:"$", KZT:"₸", LAK:"₭", LBP:"ل.ل",
  LKR:"Rs", LRD:"$", LSL:"L", LYD:"ل.د", MAD:"DH", MDL:"L", MGA:"Ar", MKD:"ден", MMK:"K",
  MNT:"₮", MOP:"MOP$", MRU:"UM", MUR:"₨", MVR:"Rf", MWK:"K", MXN:"$",
  MYR:"RM", MZN:"MT", NAD:"$", NGN:"₦", NIO:"C$", NOK:"kr", NPR:"₨", NZD:"NZ$",
  OMR:"﷼", PAB:"B/.", PEN:"S/.", PGK:"K", PHP:"₱", PKR:"₨", PLN:"zł", PYG:"₲",
  QAR:"﷼", RON:"lei", RSD:"дин.", RUB:"₽", RWF:"FRw", SAR:"﷼", SBD:"$", SCR:"₨",
  SDG:"ج.س.", SEK:"kr", SGD:"S$", SHP:"£", SLE:"Le", SOS:"Sh", SRD:"$", SSP:"£",
  STN:"Db", SYP:"£", SZL:"L", THB:"฿", TJS:"ЅМ", TMT:"m", TND:"د.ت", TOP:"T$", TRY:"₺",
  TTD:"TT$", TVD:"$", TWD:"NT$", TZS:"Sh", UAH:"₴", UGX:"USh", USD:"$", UYU:"$U",
  UZS:"so'm", VES:"Bs.S", VND:"₫", VUV:"Vt", WST:"T", XAF:"FCFA", XCD:"$", XOF:"CFA",
  XPF:"₣", XDR:"SDR", XAU:"Au", XAG:"Ag", XPT:"Pt", XPD:"Pd", YER:"﷼", ZAR:"R", ZMW:"ZK", ZWL:"$"
};

async function loadCurrencies(){
  const out = document.getElementById('curResult');
  try {
    const res = await fetch('https://api.exchangerate.host/symbols');
    const data = await res.json();
    const from = document.getElementById('curFrom');
    const to = document.getElementById('curTo');
    from.innerHTML=''; to.innerHTML='';
    Object.keys(data.symbols).sort().forEach(code=>{
      const name = data.symbols[code].description || code;
      const sym = SYMBOLS[code] ? ` (${SYMBOLS[code]})` : '';
      const label = `${code} — ${name}${sym}`;
      from.add(new Option(label, code));
      to.add(new Option(label, code));
    });
    // Smart defaults
    from.value = 'USD';
    to.value = 'PKR';
  } catch(e){
    out.textContent = 'Could not load currency symbols. Check your internet and refresh.';
  }
}

async function convertCurrency(){
  const amount = parseFloat(document.getElementById('curAmount').value || '0');
  const from = document.getElementById('curFrom').value;
  const to = document.getElementById('curTo').value;
  const out = document.getElementById('curResult');
  if(!amount || !from || !to){ out.textContent = 'Please enter amount and select currencies.'; return; }
  out.textContent = 'Converting...';
  try {
    const res = await fetch(`https://api.exchangerate.host/convert?from=${encodeURIComponent(from)}&to=${encodeURIComponent(to)}&amount=${amount}`);
    const data = await res.json();
    if(data && typeof data.result === 'number'){
      out.textContent = `${amount} ${from} = ${data.result.toFixed(4)} ${to}`;
    } else {
      out.textContent = 'Conversion failed.';
    }
  } catch(e){
    out.textContent = 'Network error during conversion.';
  }
}
loadCurrencies();

/* ========== Units ========== */
const UNIT_MAP = {
  Length: { base:'m', units: { 'mm':0.001, 'cm':0.01, 'm':1, 'km':1000, 'inch':0.0254, 'ft':0.3048, 'yd':0.9144, 'mile':1609.344 } },
  Weight: { base:'kg', units: { 'mg':1e-6, 'g':1e-3, 'kg':1, 'ton':1000, 'oz':0.0283495231, 'lb':0.45359237 } },
  Temperature: { special:true, units: ['C','F','K'] },
  Area: { base:'m2', units: { 'cm2':1e-4, 'm2':1, 'km2':1e6, 'inch2':0.00064516, 'ft2':0.09290304, 'acre':4046.8564224, 'hectare':10000 } },
  Volume: { base:'L', units: { 'ml':0.001, 'L':1, 'm3':1000, 'tsp':0.00492892, 'tbsp':0.0147868, 'cup':0.24, 'pt':0.473176, 'qt':0.946353, 'gal':3.78541 } },
  Speed: { base:'mps', units: { 'mps':1, 'kmh':0.277777778, 'mph':0.44704, 'knot':0.514444 } }
};
function populateUnits(){
  const cat = document.getElementById('unitCategory').value;
  const from = document.getElementById('unitFrom');
  const to = document.getElementById('unitTo');
  from.innerHTML = ''; to.innerHTML = '';
  if(UNIT_MAP[cat].special){
    ['C','F','K'].forEach(u=>{
      from.add(new Option(u, u)); to.add(new Option(u, u));
    });
    from.value='C'; to.value='F';
  } else {
    const entries = Object.keys(UNIT_MAP[cat].units);
    entries.forEach(u=>{
      from.add(new Option(u, u)); to.add(new Option(u, u));
    });
    from.value = entries[0]; to.value = entries[1] || entries[0];
  }
}
populateUnits();
function convertUnits(){
  const cat = document.getElementById('unitCategory').value;
  const val = parseFloat(document.getElementById('unitValue').value || '0');
  const from = document.getElementById('unitFrom').value;
  const to = document.getElementById('unitTo').value;
  const out = document.getElementById('unitResult');
  if(isNaN(val)){ out.textContent='Enter a number.'; return; }
  if(UNIT_MAP[cat].special){
    let result;
    if(from==='C'&&to==='F') result = val*9/5+32;
    else if(from==='F'&&to==='C') result = (val-32)*5/9;
    else if(from==='C'&&to==='K') result = val+273.15;
    else if(from==='K'&&to==='C') result = val-273.15;
    else if(from==='F'&&to==='K') result = (val-32)*5/9+273.15;
    else if(from==='K'&&to==='F') result = (val-273.15)*9/5+32;
    else result = val;
    out.textContent = `${val} ${from} = ${result} ${to}`;
  } else {
    const map = UNIT_MAP[cat].units;
    const toBase = val * map[from];
    const result = toBase / map[to];
    out.textContent = `${val} ${from} = ${result} ${to}`;
  }
}

/* ========== Time zones (Luxon) ========== */
const DateTime = luxon.DateTime;
function getTimeZones(){
  if (Intl.supportedValuesOf) {
    try { return Intl.supportedValuesOf('timeZone'); } catch {}
  }
  return [
    'UTC','Europe/London','Europe/Paris','Africa/Cairo','Asia/Karachi','Asia/Kolkata','Asia/Dubai',
    'Asia/Tokyo','Asia/Singapore','Australia/Sydney','America/New_York','America/Chicago',
    'America/Denver','America/Los_Angeles','America/Sao_Paulo'
  ];
}
function populateTZ(){
  const zones = getTimeZones();
  const from = document.getElementById('tzFrom');
  const to = document.getElementById('tzTo');
  zones.forEach(z=>{ from.add(new Option(z,z)); to.add(new Option(z,z)); });
  try {
    const guess = Intl.DateTimeFormat().resolvedOptions().timeZone || 'Asia/Karachi';
    from.value = guess;
  } catch { from.value = 'Asia/Karachi'; }
  to.value = 'UTC';
  document.getElementById('tzDateTime').value = DateTime.now().toFormat("yyyy-LL-dd'T'HH:mm");
}
populateTZ();
function convertTime(){
  const isoLocal = document.getElementById('tzDateTime').value;
  const from = document.getElementById('tzFrom').value;
  const to = document.getElementById('tzTo').value;
  const out = document.getElementById('tzResult');
  if(!isoLocal || !from || !to){ out.textContent='Pick date/time and zones.'; return; }
  try {
    const dtFrom = DateTime.fromISO(isoLocal, { zone: from });
    if(!dtFrom.isValid){ out.textContent='Invalid date/time.'; return; }
    const dtTo = dtFrom.setZone(to);
    out.innerHTML = `
      <div><strong>${dtFrom.toFormat('FFF')}</strong> in <code>${from}</code></div>
      <div>↳ equals</div>
      <div><strong>${dtTo.toFormat('FFF')}</strong> in <code>${to}</code></div>
      <div class="hint">UTC offsets: ${from} ${dtFrom.toFormat('ZZ')} → ${to} ${dtTo.toFormat('ZZ')}</div>
    `;
  } catch(e){
    out.textContent='Conversion failed.';
  }
}

/* ========== File: image convert ========== */
function convertImage(){
  const fileInput = document.getElementById('imgInput');
  const fmt = document.getElementById('imgFormat').value;
  const q = parseFloat(document.getElementById('imgQuality').value || '0.9');
  const out = document.getElementById('imgResult');
  if(!fileInput.files.length){ out.textContent='Please choose an image.'; return; }
  const file = fileInput.files[0];
  const img = new Image();
  const url = URL.createObjectURL(file);
  img.onload = ()=>{
    const canvas = document.createElement('canvas');
    canvas.width = img.width; canvas.height = img.height;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(img,0,0);
    canvas.toBlob((blob)=>{
      if(!blob){ out.textContent='Conversion failed.'; return; }
      const dlUrl = URL.createObjectURL(blob);
      const a = document.createElement('a');
      const ext = fmt.split('/')[1].replace('jpeg','jpg');
      a.href = dlUrl; a.download = `converted.${ext}`;
      a.textContent = `Download converted.${ext} (${(blob.size/1024).toFixed(1)} KB)`;
      out.innerHTML = ''; out.appendChild(a);
      URL.revokeObjectURL(url);
    }, fmt, q);
  };
  img.onerror = ()=>{ out.textContent='Could not read image.'; URL.revokeObjectURL(url); };
  img.src = url;
}

/* ========== File: CSV ⇄ JSON ========== */
function csvToJson(){
  const text = document.getElementById('textInput').value.trim();
  if(!text){ document.getElementById('textOutput').value=''; return; }
  const lines = text.split(/\r?\n/).filter(l=>l.length);
  const headers = parseCsvLine(lines[0]);
  const rows = lines.slice(1).map(parseCsvLine);
  const objs = rows.map(r=>{
    const o={}; headers.forEach((h,i)=>o[h]=r[i]??''); return o;
  });
  document.getElementById('textOutput').value = JSON.stringify(objs, null, 2);
}
function jsonToCsv(){
  const text = document.getElementById('textInput').value.trim();
  if(!text){ document.getElementById('textOutput').value=''; return; }
  let arr;
  try { arr = JSON.parse(text); } catch{ document.getElementById('textOutput').value='Invalid JSON'; return; }
  if(!Array.isArray(arr) || arr.length===0){ document.getElementById('textOutput').value='JSON must be an array of objects'; return; }
  const headers = Array.from(new Set(arr.flatMap(o=>Object.keys(o))));
  const csv = [headers.join(',')].concat(arr.map(o=>headers.map(h=>csvEscape(o[h])).join(','))).join('\n');
  document.getElementById('textOutput').value = csv;
}
function parseCsvLine(line){
  const re = /("([^"]|"")*"|[^,]+)|(?<=,)(?=,)|^$/g;
  const out=[]; let m;
  while((m=re.exec(line))!==null){
    let field = m[0] || '';
    if(field.startsWith('"')){
      field = field.slice(1,-1).replace(/""/g,'"');
    }
    out.push(field);
  }
  if(out.length && out[out.length-1]==='') out.pop();
  return out;
}
function csvEscape(value){
  const s = value==null ? '' : String(value);
  if(/[",\n]/.test(s)) return `"${s.replace(/"/g,'""')}"`;
  return s;
}
function downloadText(){
  const text = document.getElementById('textOutput').value;
  const blob = new Blob([text], {type:'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'output.txt';
  a.click();
  URL.revokeObjectURL(url);
}

/* ========== Text tools ========== */
function toBase64(){
  const s = document.getElementById('txtToolInput').value;
  document.getElementById('txtToolOutput').value = btoa(unescape(encodeURIComponent(s)));
}
function fromBase64(){
  const s = document.getElementById('txtToolInput').value;
  try { document.getElementById('txtToolOutput').value = decodeURIComponent(escape(atob(s))); }
  catch { document.getElementById('txtToolOutput').value = 'Invalid Base64'; }
}
function toUpper(){ document.getElementById('txtToolOutput').value = document.getElementById('txtToolInput').value.toUpperCase(); }
function toLower(){ document.getElementById('txtToolOutput').value = document.getElementById('txtToolInput').value.toLowerCase(); }
function toTitle(){
  const s = document.getElementById('txtToolInput').value;
  document.getElementById('txtToolOutput').value = s.toLowerCase().replace(/\b\w/g, c=>c.toUpperCase());
}

/* ========== PDF tools (pdf-lib) ========== */
const { PDFDocument, StandardFonts, rgb } = PDFLib;

async function mergePDFs(){
  const files = document.getElementById('pdfMergeFiles').files;
  const out = document.getElementById('pdfMergeResult');
  if (!files.length){ out.textContent='Select PDF files first.'; return; }
  out.textContent = 'Merging...';
  try {
    const merged = await PDFDocument.create();
    for (let file of files) {
      const bytes = await file.arrayBuffer();
      const pdf = await PDFDocument.load(bytes);
      const pages = await merged.copyPages(pdf, pdf.getPageIndices());
      pages.forEach(p => merged.addPage(p));
    }
    const mergedBytes = await merged.save();
    const blob = new Blob([mergedBytes], { type: 'application/pdf' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'merged.pdf'; a.textContent = 'Download merged.pdf';
    out.innerHTML = ''; out.appendChild(a);
  } catch (e) {
    out.textContent = 'Merge failed.';
  }
}

function parseRanges(str){
  // e.g., "1-3,5,7-9" -> [1,2,3,5,7,8,9] (1-based indices)
  const set = new Set();
  str.split(',').map(s=>s.trim()).filter(Boolean).forEach(part=>{
    const m = part.match(/^(\d+)(-(\d+))?$/);
    if(!m) return;
    const start = parseInt(m[1],10);
    const end = m[3] ? parseInt(m[3],10) : start;
    for(let i=start;i<=end;i++) set.add(i);
  });
  return Array.from(set).sort((a,b)=>a-b);
}

async function splitPDF(){
  const file = document.getElementById('pdfSplitFile').files[0];
  const rangeStr = document.getElementById('pdfRange').value.trim();
  const out = document.getElementById('pdfSplitResult');
  if(!file){ out.textContent='Select a PDF file.'; return; }
  if(!rangeStr){ out.textContent='Enter a page range.'; return; }
  out.textContent='Splitting...';
  try {
    const bytes = await file.arrayBuffer();
    const src = await PDFDocument.load(bytes);
    const total = src.getPageCount();
    const wanted = parseRanges(rangeStr).filter(n=>n>=1 && n<=total);
    if(!wanted.length){ out.textContent = `No valid pages in range (PDF has ${total} pages).`; return; }
    const dst = await PDFDocument.create();
    const copied = await dst.copyPages(src, wanted.map(n=>n-1));
    copied.forEach(p=>dst.addPage(p));
    const outBytes = await dst.save();
    const blob = new Blob([outBytes], { type:'application/pdf' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'split.pdf'; a.textContent = `Download split.pdf (${wanted.length} page${wanted.length>1?'s':''})`;
    out.innerHTML=''; out.appendChild(a);
  } catch(e){
    out.textContent = 'Split failed.';
  }
}

function pxToPt(px){ return px * 72 / 96; } // approx assuming 96dpi

async function imagesToPDF(){
  const files = Array.from(document.getElementById('pdfImages').files || []);
  const pageSizeSel = document.getElementById('pdfPageSize').value;
  const out = document.getElementById('pdfImgResult');
  if(!files.length){ out.textContent='Select images first.'; return; }
  out.textContent='Building PDF...';
  try {
    const doc = await PDFDocument.create();
    for(const file of files){
      const array = await file.arrayBuffer();
      let img, dims;
      if(file.type === 'image/jpeg' || /\.jpe?g$/i.test(file.name)){
        img = await doc.embedJpg(array); dims = img.scale(1);
      } else {
        img = await doc.embedPng(array); dims = img.scale(1);
      }
      let page;
      if(pageSizeSel === 'fit'){
        page = doc.addPage([pxToPt(dims.width), pxToPt(dims.height)]);
        page.drawImage(img, { x: 0, y: 0, width: page.getWidth(), height: page.getHeight() });
      } else {
        const A4P = [595.28, 841.89]; // pt
        const size = pageSizeSel === 'A4' ? A4P : [A4P[1], A4P[0]];
        page = doc.addPage(size);
        const maxW = page.getWidth() - 36*2;
        const maxH = page.getHeight() - 36*2;
        const scale = Math.min(maxW/dims.width, maxH/dims.height);
        const w = dims.width*scale, h = dims.height*scale;
        const x = (page.getWidth()-w)/2;
        const y = (page.getHeight()-h)/2;
        page.drawImage(img, { x, y, width: w, height: h });
      }
    }
    const bytes = await doc.save();
    const blob = new Blob([bytes], {type:'application/pdf'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'images.pdf'; a.textContent = 'Download images.pdf';
    out.innerHTML=''; out.appendChild(a);
  } catch(e){
    out.textContent='Failed to create PDF.';
  }
}
</script>
</body>
</html>
